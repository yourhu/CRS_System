{% extends 'base.html' %}
{% load static %}
{% block title %}{{ product.name }} - CRS 系统{% endblock %}

{% block content %}
<div class="container my-5">
    <div class="row g-5">
        <!-- 商品图片 -->
        <div class="col-md-6">
            {% if product.image %}
                <img src="{{ product.image.url }}" class="img-fluid rounded shadow-sm" alt="{{ product.name }}">
            {% else %}
                <img src="{% static 'images/product_placeholder.jpg' %}" class="img-fluid rounded shadow-sm" alt="默认图片">
            {% endif %}
        </div>

        <!-- 商品信息 -->
        <div class="col-md-6">
            <h2 class="fw-bold">{{ product.name }}</h2>
            <p class="text-muted">分类：<strong>{{ product.category.name }}</strong></p>
            <p class="h4 text-danger">¥{{ product.price }}</p>
            <p>库存：
                {% if product.stock > 0 %}
                    <span class="text-success">有货 ({{ product.stock }} 件)</span>
                {% else %}
                    <span class="text-danger">暂无库存</span>
                {% endif %}
            </p>
            <p>商家：{{ product.merchant.username }}</p>
            <p>创建时间：{{ product.created_at|date:"Y-m-d H:i" }}</p>

            <hr>

            <form method="post" action="{% url 'create_order' %}">
                {% csrf_token %}
                <input type="hidden" name="product_id" value="{{ product.id }}">

<h5 class="mb-3">商品规格</h5>
{% if specifications %}
    {% for key, values, is_list in specifications %}
        <div class="mb-3">
            <label class="form-label fw-semibold">{{ key }}</label>
            {% if is_list %}
                <select name="spec_{{ key }}" class="form-select">
                    {% for option in values %}
                        <option value="{{ option }}">{{ option }}</option>
                    {% endfor %}
                </select>
            {% else %}
                <p class="form-control-plaintext">{{ values }}</p>
            {% endif %}
        </div>
    {% endfor %}
{% else %}
    <p class="text-muted">暂无规格信息</p>
{% endif %}




                <h5 class="mt-4">商品描述</h5>
                <p class="text-body">{{ product.description|linebreaks }}</p>

                <!-- 操作按钮 -->
                <input type="hidden" name="quantity" id="quantity" value="1">
                <div class="mt-4 d-flex gap-3">
                    <button type="submit" name="action" value="add_to_order" class="btn btn-outline-primary btn-lg">
                        <i class="fas fa-cart-plus me-1"></i> 加入购物车
                    </button>
                    <button type="submit" name="action" value="buy_now" class="btn btn-success btn-lg">
                        <i class="fas fa-bolt me-1"></i> 立即购买
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}
