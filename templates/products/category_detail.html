{% extends 'base.html' %}
{% load static %}

{% block title %}
    {% if category %}{{ category.name }}{% else %}搜索结果{% endif %} - CRS 系统
{% endblock %}

{% block content %}
<div class="container py-4">
    {% if search_query %}
    <h2 class="text-center mb-4 text-primary fw-bold">搜索结果: "{{ search_query }}"</h2>
    {% elif category %}
    <h2 class="text-center mb-4 text-primary fw-bold">{{ category.name }}</h2>
    {% else %}
    <h2 class="text-center mb-4 text-primary fw-bold">所有商品</h2>
    {% endif %}

    <div class="row row-cols-1 row-cols-md-5 g-1 justify-content-center">
        {% for product in products %}
        <div class="col mb-3">
            <div class="card product-card h-100 shadow-sm border-0 rounded-3 overflow-hidden transition-transform hover-scale-up">
                {% if product.image %}
                <img src="{{ product.image.url }}" class="card-img-top" alt="{{ product.name }}" style="object-fit: cover; height: 200px;">
                {% else %}
                <img src="{% static 'images/product_placeholder.jpg' %}" class="card-img-top" alt="{{ product.name }}" style="object-fit: cover; height: 200px;">
                {% endif %}
                <div class="card-body text-center p-2 bg-light">
                    <h6 class="card-title mb-1 text-dark">{{ product.name|truncatechars:15 }}</h6>
                    <p class="card-text text-muted small mb-1">{{ product.description|truncatechars:20 }}</p>
                    <p class="card-text text-danger fw-bold small mb-2">¥{{ product.price }}</p>
                    <a href="{% url 'product_detail' product.id %}" class="btn btn-outline-primary btn-sm w-100">查看详情</a>
                </div>
            </div>
        </div>
        {% empty %}
        <p class="text-center text-secondary">{% if search_query %}未找到与 "{{ search_query }}" 相关的商品{% else %}此分类下暂无商品{% endif %}。</p>
        {% endfor %}
    </div>

    <!-- 分页导航 -->
    {% if products.has_other_pages %}
    <nav aria-label="Page navigation">
        <ul class="pagination justify-content-center mt-4">
            {% if products.has_previous %}
            <li class="page-item">
                <a class="page-link" href="?page={{ products.previous_page_number }}{% if search_query %}&q={{ search_query|urlencode }}{% endif %}">« 上一页</a>
            </li>
            {% else %}
            <li class="page-item disabled">
                <span class="page-link">« 上一页</span>
            </li>
            {% endif %}

            {% for num in products.paginator.page_range %}
            <li class="page-item {% if products.number == num %}active{% endif %}">
                <a class="page-link" href="?page={{ num }}{% if search_query %}&q={{ search_query|urlencode }}{% endif %}">{{ num }}</a>
            </li>
            {% endfor %}

            {% if products.has_next %}
            <li class="page-item">
                <a class="page-link" href="?page={{ products.next_page_number }}{% if search_query %}&q={{ search_query|urlencode }}{% endif %}">下一页 »</a>
            </li>
            {% else %}
            <li class="page-item disabled">
                <span class="page-link">下一页 »</span>
            </li>
            {% endif %}
        </ul>
    </nav>
    {% endif %}
</div>
{% endblock %}

{% block extra_css %}
<style>
    .hover-scale-up {
        transition: transform 0.3s ease;
    }
    .hover-scale-up:hover {
        transform: scale(1.05);
    }
    .card-img-top {
        transition: opacity 0.3s ease;
    }
    .card-img-top:hover {
        opacity: 0.8;
    }
</style>
{% endblock %}